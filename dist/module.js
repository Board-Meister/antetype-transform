var l={INIT:"antetype.init",CLOSE:"antetype.close",DRAW:"antetype.draw",CALC:"antetype.calc",RECALC_FINISHED:"antetype.recalc.finished",MODULES:"antetype.modules",SETTINGS:"antetype.settings.definition",TYPE_DEFINITION:"antetype.layer.type.definition",FONTS_LOADED:"antetype.font.loaded",CANVAS_CHANGE:"antetype.canvas.change"};var u="core",d="0.0.5",h=class{#e;#r=null;#t=null;static inject={marshal:"boardmeister/marshal",herald:"boardmeister/herald"};inject(r){this.#e=r}async loadModules(r){return(await this.#n()).loadModules(r)}register(r){let{registration:t}=r.detail;t[u]={load:async()=>(this.#r??=(await this.#a("core.js")).default,e=>this.#r({modules:e,herald:this.#e.herald})),version:d}}static subscriptions={[l.MODULES]:"register"};#a(r){return import(this.#e.marshal.getResourceUrl(this,r))}async#n(){return this.#t??=(await this.#a("helper.js")).default,new this.#t(this.#e.herald)}};var o=class{#e;#r;constructor(t,e){this.#e=t,this.#r=e}registerEvents(){let t=this.#r.batch([{event:l.CLOSE,subscription:()=>{t()}},{event:l.DRAW,subscription:[{method:e=>{let{element:a}=e.detail;if(!Array.isArray(a.transforms))return;let i=a.transforms,s={rotate:this.rotate.bind(this),opacity:this.opacity.bind(this),filter:this.filter.bind(this)};this.#a(),i.forEach(n=>{let c=s[n.type]??null;typeof c=="function"&&c(n,a)})},priority:-255},{method:e=>{let{element:a}=e.detail;typeof a.transform=="object"&&this.#n()},priority:255}]}])}#t(){let t=this.#e.core.meta.getCanvas();if(!t)throw new Error("[Antetype Transform] Provided canvas is empty");return t.getContext("2d")}#a(){this.#t().save()}#n(){this.#t().restore()}rotate(t,e){let{start:{x:a,y:i},size:{w:s,h:n}}=e;this.#t().translate(a+s/2,i+n/2),this.#t().rotate(t.data.degree*Math.PI/180),this.#t().translate(-(a+s/2),-(i+n/2))}opacity(t){this.#t().globalAlpha=t.data.alpha}filter(t){this.#t().filter=t.data.filter}};export{o as default};
