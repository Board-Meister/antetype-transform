var n={INIT:"antetype.init",CLOSE:"antetype.close",DRAW:"antetype.draw",CALC:"antetype.calc",RECALC_FINISHED:"antetype.recalc.finished",MODULES:"antetype.modules",SETTINGS:"antetype.settings.definition",TYPE_DEFINITION:"antetype.layer.type.definition",FONTS_LOADED:"antetype.font.loaded",CANVAS_CHANGE:"antetype.canvas.change"};var p="core",m="0.0.5",y=class{#e;#r=null;#t=null;static inject={marshal:"boardmeister/marshal",herald:"boardmeister/herald"};inject(a){this.#e=a}async loadModules(a){return(await this.#n()).loadModules(a)}register(a){let{registration:e}=a.detail;e[p]={load:async()=>(this.#r??=(await this.#a("core.js")).default,r=>this.#r({modules:r,herald:this.#e.herald})),version:m}}static subscriptions={[n.MODULES]:"register"};#a(a){return import(this.#e.marshal.getResourceUrl(this,a))}async#n(){return this.#t??=(await this.#a("helper.js")).default,new this.#t(this.#e.herald)}};var l=class{#e;#r;constructor(e,r){this.#e=e,this.#r=r}registerEvents(){let e=this.#r.batch([{event:n.CLOSE,subscription:()=>{e()}},{event:n.DRAW,subscription:[{method:r=>{let{element:t}=r.detail;if(!Array.isArray(t.transforms))return;let s=t.transforms,o={rotate:this.rotate.bind(this),opacity:this.opacity.bind(this),filter:this.filter.bind(this)};this.#a(),s.forEach(i=>{let c=o[i.type]??null;typeof c=="function"&&c(i,t)})},priority:-255},{method:r=>{let{element:t}=r.detail;typeof t.transform=="object"&&this.#n()},priority:255}]}])}#t(){let e=this.#e.core.meta.getCanvas();if(!e)throw new Error("[Antetype Transform] Provided canvas is empty");return e.getContext("2d")}#a(){this.#t().save()}#n(){this.#t().restore()}rotate(e,r){let{start:{x:t,y:s},size:{w:o,h:i}}=r;this.#t().translate(t+o/2,s+i/2),this.#t().rotate(e.data.degree*Math.PI/180),this.#t().translate(-(t+o/2),-(s+i/2))}opacity(e){this.#t().globalAlpha=e.data.alpha}filter(e){this.#t().filter=e.data.filter}};var u="transform",h="0.0.4",d=class{#e;#r=null;static inject={marshal:"boardmeister/marshal",herald:"boardmeister/herald"};inject(e){this.#e=e}register(e){let{registration:r}=e.detail;r[u]={load:async()=>{if(!this.#r){let t=this.#e.marshal.getResourceUrl(this,"module.js");this.#r=(await import(t)).default}return t=>new this.#r(t,this.#e.herald)},version:h}}static subscriptions={[n.MODULES]:"register"}};export{u as ID,l as Transformer,h as VERSION};
